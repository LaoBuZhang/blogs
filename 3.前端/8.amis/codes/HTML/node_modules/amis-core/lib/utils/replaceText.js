/**
 * amis-core v2.7.2
 * Copyright 2018-2023 fex
 */

'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var cloneDeep = require('lodash/cloneDeep');
var helper = require('./helper.js');
var object = require('./object.js');

function _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }

var cloneDeep__default = /*#__PURE__*/_interopDefaultLegacy(cloneDeep);

/**
 * 对文本进行替换
 */
function replaceText(schema, replaceText, replaceTextIgnoreKeys) {
    // 进行文本替换
    if (replaceText && object.isObject(replaceText)) {
        var replicaSchema = cloneDeep__default["default"](schema);
        var replaceKeys_1 = Object.keys(replaceText);
        replaceKeys_1.sort(function (a, b) { return b.length - a.length; }); // 避免用户将短的放前面
        var IgnoreKeys_1 = new Set(replaceTextIgnoreKeys || []);
        helper.JSONTraverse(replicaSchema, function (value, key, object) {
            var descriptor = Object.getOwnPropertyDescriptor(object, key);
            if (typeof value === 'string' &&
                !IgnoreKeys_1.has(key) &&
                (descriptor === null || descriptor === void 0 ? void 0 : descriptor.writable)) {
                for (var _i = 0, replaceKeys_2 = replaceKeys_1; _i < replaceKeys_2.length; _i++) {
                    var replaceKey = replaceKeys_2[_i];
                    if (~value.indexOf(replaceKey)) {
                        value = object[key] = value.replaceAll(replaceKey, replaceText[replaceKey]);
                    }
                }
            }
        });
        return replicaSchema;
    }
    return schema;
}

exports.replaceText = replaceText;
